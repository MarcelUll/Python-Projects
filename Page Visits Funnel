import pandas as pd


visits = pd.read_csv('visits.csv')
cart = pd.read_csv('cart.csv')
checkout = pd.read_csv('checkout.csv')
purchase = pd.read_csv('purchase.csv')

print(visits.head())
print(cart.head())
print(checkout.head())
print(purchase.head())

#left merging vists and cart
visits_card_left = pd.merge(visits,cart,how='left')
print(visits_card_left.head())
print(len(visits_card_left))

#how many timestamps for cart_time are null?
cart_time_empty = len(visits_card_left[visits_card_left.cart_time.isnull()])
print(cart_time_empty)

#what percentage only visited?
visit_only_percentage = round((cart_time_empty / len(visits_card_left))*100, 2)
print(visit_only_percentage)

#cart without checkout
cart_checkout = pd.merge(cart, checkout,how='left')
cart_only = len(cart_checkout[cart_checkout.checkout_time.isnull()])
cart_only_percentage = round((cart_only /len(cart_checkout))*100, 2)

#merge everything
complete_db = visits.merge(cart, how='outer').merge(checkout,how='outer').merge(purchase,how='outer')
print(complete_db.head())

#checkout without purchase
checkout_only = complete_db[(complete_db.purchase_time.isnull())&(~complete_db.checkout_time.isnull())]
reached_checkout = complete_db[(~complete_db.checkout_time.isnull())]
checkout_only_percentage = round(float(len(checkout_only)) / float(len(reached_checkout))*100,2)

#check all percentages
print(visit_only_percentage,cart_only_percentage,checkout_only_percentage)

#time to purchase
complete_db['visit_time'] = pd.to_datetime(complete_db['visit_time'])
complete_db['purchase_time'] = pd.to_datetime(complete_db['purchase_time'])
complete_db['time_to_purchase'] = complete_db.purchase_time - complete_db.visit_time
print(complete_db.time_to_purchase)

#average time to purchase
print(complete_db.time_to_purchase.mean())
